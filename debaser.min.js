/*! angular-debaser - v0.2.3 - 2014-07-15
* https://github.com/decipherinc/angular-debaser
* Copyright (c) 2014 Decipher, Inc.; Licensed MIT */
!function(a,b){"use strict";var c={debugEnabled:!1,autoScope:!0,skipConfigs:!0,_default_name:"__default__"},d=function(d){var e=function(e){e.constant("decipher.debaser.options",b.extend({},c,d)),e.constant("decipher.debaser.runConfig",a.debaser.$$config)};return e.$inject=["$provide"],e},e=function(){return!!f.$$currentSpec},f=function h(a,f){var g,i,j,k,l=c._default_name,m=h.getInstance,n=h.hasInstance;return b.isObject(a)&&(f=a,a=null),f=f||{},k=d(f),b.mock.module(k,"decipher.debaser"),!a&&n(l)?(delete h.$$globalInstance,m(l)):(j=b.injector(["ng",k,"decipher.debaser"]),g=j.get("decipher.debaser.debaser"),a?(n(a)||(h.$$debasers[a]=new g(a)),delete h.$$globalInstance,m(a)):(i=new g,e()?delete h.$$globalInstance:h.$$globalInstance=i,i))};f.getInstance=function(a){return f.$$debasers[a]},f.hasInstance=function(a){return!!f.getInstance(a)},f.$$debasers={},f.$$config={},(a.beforeEach||a.setup)(function(){f.$$currentSpec=this}),(a.afterEach||a.teardown)(function(){delete f.$$currentSpec});var g=function(){var a=c._default_name,d=arguments[0],g=function(){if(d&&b.isString(d)){if(!f.hasInstance(d))throw new Error('debaser: cannot find Debaser instance with name "'+d+'"')}else{if(!f.hasInstance(a)){if(f.$$globalInstance)return f.$$globalInstance.debase({persist:!0});throw new Error("debaser: no Debaser initialized!")}d=a}f.getInstance(d).debase({persist:d!==a})};return e()?g():g};f.debase=g,a.debaser=f,a.debase=g,b.module("decipher.debaser",[]).constant("decipher.debaser.runConfig",a.debaser.$$config).config(["decipher.debaser.options","$logProvider","$provide",function(a,c,d){b.isFunction(c.debugEnabled)&&c.debugEnabled(a.debugEnabled),d.decorator("$log",["$delegate",function(c){return c.debug=c.debug||a.debugEnabled?c.log:b.noop,c}])}]),b.module("decipher.debaser").factory("decipher.debaser.loadAction",function(){var a=function(a){b.extend(this,a)};return a.prototype.deserialize=function(){return function(){this.callback(this.object[this.func].apply(this.context,this.args))}.bind(this)},function(b){return b.actions.map(function(b){return new a(b)})}}),b.module("decipher.debaser").factory("decipher.debaser.aspect",["decipher.debaser.superpowers","decipher.debaser.behavior",function(a,c){var d=function e(a,b){this.name=a,this.parent=b,this._id=e._id++};return d._id=0,d._DEFAULT_NAME="base",Object.defineProperties(d.prototype,{name:{get:function(){return this._name},set:function(a){this._dirty=this._isDirty(a,"_name"),this._name=a||d._DEFAULT_NAME}},parent:{get:function(){return this._parent},set:function(a){this._dirty=this._isDirty(a,"_parent"),this._parent=a}},proto:{get:function(){var a=this._dirty;return(!this._proto||a)&&this._initProto(),this._dirty=!1,this._proto},set:function(a){this._proto=a}},behavior:{get:function(){var a=this._dirty;return(!this._behavior||a)&&this._initBehavior(),this._dirty=!1,this._behavior},set:function(a){this._behavior=a}},config:{get:function(){return this.behavior.config},set:function(a){this.behavior.config=a}}}),d.prototype._initProto=function(){var c;(!this._proto||this._dirty)&&(c={},this.parent&&b.extend(c,this.parent.proto),b.forEach(a,function(a,b){"$"!==b.charAt(0)&&-1!==a.$aspect.indexOf(this._name)&&(c[b]=this.createProxy(a,b))},this),this._proto=c)},d.prototype._initBehavior=function(){(!this._behavior||this._dirty)&&(this._behavior=new c(b.extend(this._behavior||{},this.parent&&this.parent.isAspectOf(this.name)&&this.parent.behavior),this.name))},d.prototype.flush=function(){return this.behavior.flush()},d.prototype._isDirty=function(a,b){return a&&a!==this[b]||!a&&this[b]},d.prototype.createProxy=function(a,c){var d;return d=function(){var d,e,f=this.$$aspect,g=f.isAspectOf(c),h=this;return g||"base"===f.name||this.$enqueue(),d=this.$aspect(a.$name||c),e=a.apply(d.config,arguments),b.isArray(e)?d.behavior.enqueue(e):e&&(h=e),h}},d.prototype.createProxy.cache={},d.prototype.isAspectOf=function(b){return"base"!==b&&a[b]&&-1!==a[b].$aspect.indexOf(this.name)},d}]),b.module("decipher.debaser").factory("decipher.debaser.behavior",["decipher.debaser.config",function(a){var c=function d(a,c){b.extend(this,a),this._aspect_name=c,this._id=d._id++};return c._id=0,c.prototype.enqueue=function(a){this.queue.push.apply(this.queue,a)},c.prototype.flush=function(){return this.queue.map(function(a){return a.deserialize()})},Object.defineProperties(c.prototype,{queue:{get:function(){return this._queue||(this._queue=[]),this._queue},set:function(a){this._queue=a||[]}},config:{get:function(){return this._config||(this._config=new a(this._aspect_name)),this._config},set:function(b){this._config=b||new a(this._aspect_name)}}}),c}]),b.module("decipher.debaser").factory("decipher.debaser.config",function(){var a=function c(a,d){b.isString(a)?d=a:b.extend(this,a),this._aspect_name=d,this._callbacks=[],this._cb_idx=0,this._id=c._id++,this.actions=this.actions||[]};return a._id=0,a.prototype.addAction=function(a){if(!a)throw new Error("$debaser: addCall() expects call options");a.callback=a.callback||this.runner(),a.context=b.isDefined(a.context)?a.context:a.object||null,this.actions.push(a)},a.prototype.next=function(){this._callbacks[this._cb_idx]?this._callbacks[this._cb_idx++].apply(this,arguments):this.done()},a.prototype.done=function(){this._cb_idx=0},a.prototype.chain=function(a){this._callbacks.push(function(){this.next(a.apply(this,arguments))}.bind(this))},a.prototype.runner=function(){return function(){this.next.apply(this,arguments)}.bind(this)},a.prototype.isChained=function(){return!!this._callbacks.length},a}),b.module("decipher.debaser").factory("decipher.debaser.debaser",["$log","decipher.debaser.aspect","decipher.debaser.options","$window",function(a,c,d,e){var f=(e.beforeEach,d.default_name),g=function(c){b.isString(c)||(c=d._default_name),this.$name=c,this.$queue=[],this.$aspect("base"),a.debug(c!==f?'$debaser: created Debaser instance with name "'+c+'"':"$debaser: created singleton Debaser instance")};return g.prototype.$aspect=function(a){var d,e,f=this.$$aspect;return b.isUndefined(a)&&(a=f.name),f&&(e=f.proto,Object.keys(e).forEach(function(a){delete this[a]},this)),d=new c(a,f),b.extend(this,d.proto),this.$$aspect=d,d},g.prototype.$enqueue=function(){var a=this.$$aspect;a&&this.$queue.push.apply(this.$queue,a.flush())},g.autoScopeProvider=function(a){a.decorator("$controller",["$rootScope","$delegate",function(a,b){return function(c,d){return d=d||{},d.$scope||(d.$scope=a.$new()),b(c,d),d.$scope}}])},g.autoScopeProvider.$inject=["$provide"],g.prototype.debase=function(a){a=a||{},this.$enqueue(),this.$queue.forEach(function(a){a()}),a.persist||(this.$queue=[]),this.$aspect("base"),d.autoScope&&b.mock.module(g.autoScopeProvider)},g}]),b.module("decipher.debaser").factory("decipher.debaser.superpowers",["decipher.debaser.loadAction","$window","decipher.debaser.runConfig","$log","decipher.debaser.options",function(a,c,d,e,f){var g,h,i,j,k,l,m,n=c.sinon,o=["create","resetBehavior","isPresent"],p=function(a){return"stub"===a.displayName||"spy"===a.displayName},q=function(a){return this.name&&this.stub&&a&&a.constant?a.constant(this.name,this.stub):void 0};g=function s(c,d){var e,g;if(c||(c="dummy-"+s.$id++),!b.isString(c))throw new Error("$debaser: module() expects a string");if(this.module=c,this.module_dependencies=[],d){if(!b.isArray(d))throw new Error("$debaser: module() expects array or undefined as second parameter");r.withDeps.call(this,d)}try{if(e=b.module(c),f.skipConfigs&&e)for(g=e._invokeQueue.length;g--;)"$injector"===e._invokeQueue[g][0]&&"invoke"===e._invokeQueue[g][1]&&e._invokeQueue.splice(g,1)}catch(h){}return this.addAction({object:b,func:"module",args:e?[this.module]:[this.module,this.module_dependencies]}),this.addAction({object:b.mock,func:"module",args:[this.module]}),a(this)},g.$aspect=["base"],g.$id=0,h=function(){return arguments.length?(Array.prototype.slice.call(arguments).forEach(function(a){if(!b.isString(a))throw new Error("$debaser: withDep() expects one or more strings")}),void this.module_dependencies.push.apply(this.module_dependencies,arguments)):e.debug("$debaser: ignoring empty call to withDep()")},h.$aspect=["module"],i=function(a){if(!a)return e.debug("$debaser: ignoring empty call to withDeps()");if(!b.isArray(a))throw new Error("$debaser: withDeps() expects an array");h.apply(this,a)},i.$aspect=["module"],j=function(a){var c=Array.prototype.slice.call(arguments,1);if(!a)return e.debug("$debaser: ignoring empty call to func()");if(!b.isString(a))throw new Error("$debaser: func() expects a name");return this.func=n&&n.stub?n.stub.apply(n,c):function(){},k.call(this,a,this.func)},j.$aspect=["base"],k=function(c,f){if(!c)return e.debug("$debaser: ignoring empty call to object()");if(!b.isString(c))throw new Error("$debaser: object() expects a name");if(f&&!b.isFunction(f)&&!b.isObject(f))throw new Error("$debaser: object() second param should be an Object or undefined");return this.stub||(b.isObject(f)||b.isFunction(f)||(f={}),this.stub=b.isObject(f)&&n&&n.stub&&!p(f)?n.stub(f):f),this.isChained()?void 0:(this.name=c,this.component="value",this.provider=function g(a,b){var c=b[g._id];a[c.component](c.name,c.stub)},this.provider.toString=function(){return"debaserProvider-"+this._id.toString()}.bind(this),this.provider._id=this._id,this.provider.$inject=["$provide","decipher.debaser.runConfig"],this.addAction({object:b.mock,func:"module",args:[this.provider]}),d[this._id]=this,a(this))},k.$aspect=["base"],l=function(a){var c=Array.prototype.slice.call(arguments,1);b.isObject(this.stub)?(this.func=n&&n.stub?n.stub.apply(n,c):function(){},this.stub[a]=this.func):(this.name=a,this.chain(q.bind(this)),j.apply(this,arguments))},l.$aspect=["module","object","withObject"],m=function(a){this.name=a,this.chain(q.bind(this)),k.apply(this,arguments)},m.$aspect=["module"];var r={func:j,module:g,object:k,withDep:h,withDeps:i,withFunc:l,withObject:m,$SINON_EXCLUDE:o};return b.forEach(r,function(a,b){a.$name||(a.$name=b)}),n&&b.forEach(n.stub,function(a,c){if(b.isFunction(a)&&-1===o.indexOf(c)){var d=function(){var b=a.apply(this.func,arguments);return b&&b.stub&&b.stub.func?(b.end=function(){return this}.bind(this),b):void 0};d.$aspect=["func","withFunc"],r[c]=d}}),r}])}(window,window.angular);
//# sourceMappingURL=debaser.min.js.map