/*! angular-debaser - v0.1.0 - 2014-07-04
* https://github.com/decipherinc/angular-debaser
* Copyright (c) 2014 Decipher, Inc.; Licensed MIT */

!function(a,b){"use strict";var c={debugEnabled:!1};b.module("decipher.debaser",[]).config(["decipher.debaser.options","$logProvider","$provide",function(a,c,d){b.isFunction(c.debugEnabled)&&c.debugEnabled(a.debugEnabled),d.decorator("$log",["$delegate",function(a){return a.debug||b.noop}])}]).factory("$debaser",["$log","$aspect",function(c,d){var e=function f(a){b.isString(a)||(a=f.DEFAULT_NAME),this.$name=a,this.$queue=[],this.$aspect("base"),c(a!==f.DEFAULT_NAME?'$debaser: created Debaser instance with name "'+a+'"':"$debaser: created singleton Debaser instance")};return e.DEFAULT_NAME="__default__",e.prototype.$$config=function(){return this.$$aspect.config},e.prototype.$aspect=function(a){var c,e,f=this.$$aspect;return a?(f&&(e=f.proto,Object.keys(e).forEach(function(a){delete this[a]},this)),c=new d(a,f),b.extend(this,c.proto),this.$$aspect=c,c):f},e.prototype.$enqueue=function(){var a=this.$$aspect;a&&this.$queue.push.apply(this.$queue,a.flush())},e.prototype.debase=function(){this.$enqueue(),this.$queue.forEach(function(b){a.console.log(b.toString()),b()}),this.$queue=[],this.$aspect("base")},e}]);var d=function(a){return function(d){d.constant("decipher.debaser.options",b.extend({},c,a))}};d.$inject=["$provide"],a.debaser=function(c,e){var f,g,h,i=a.debaser.$$debasers;return b.isObject(c)&&(e=c,c=null),!c&&i.__default__?i.__default__:(e=e||{},h=b.injector(["ng",d(e),"decipher.debaser"]),f=h.get("$debaser"),c?(i[c]||(i[c]=new f(c)),i[c]):(i.__default__=g=new f,a.debase=g.debase.bind(g),g))},a.debaser.$$debasers={}}(window,window.angular),function(a){"use strict";a.module("decipher.debaser").factory("$aspect",["$superpowers","$behavior",function(b,c){var d=function(a,b){this.name=a,this.parent=b};return d._DEFAULT_NAME="base",Object.defineProperties(d.prototype,{name:{get:function(){return this._name},set:function(a){this._dirty=this._isDirty(a,"_name"),this._name=a||d._DEFAULT_NAME}},parent:{get:function(){return this._parent},set:function(a){this._dirty=this._isDirty(a,"_parent"),this._parent=a}},proto:{get:function(){var a=this._dirty;return(!this._proto||a)&&this._initProto(a),this._dirty=!1,this._proto},set:function(a){this._proto=a}},behavior:{get:function(){var a=this._dirty;return(!this._behavior||a)&&this._initBehavior(a),this._dirty=!1,this._behavior},set:function(a){this._behavior=a}},config:{get:function(){return this.behavior.config},set:function(a){this.behavior.config=a}}}),d.prototype._initProto=function(c){var d;(!this._proto||c)&&(d={},this.parent&&a.extend(d,this.parent.proto),a.forEach(b,function(a,b){"$"!==b.charAt(0)&&-1!==a.$aspect.indexOf(this._name)&&(d[b]=this.createProxy(a,b))},this),this._proto=d)},d.prototype._initBehavior=function(b){(!this._behavior||b)&&(this._behavior=new c(a.extend(this._behavior||{},this.parent&&this.parent.isAspectOf(this.name)&&this.parent.behavior)))},d.prototype.flush=function(){return this.behavior.flush()},d.prototype.reset=function(){this.behavior.reset()},d.prototype._isDirty=function(a,b){return a&&a!==this[b]||!a&&this[b]},d.prototype.createProxy=function(b,c){var d,e=this.createProxy.cache;return e[c]?e[c]:(d=function(){var d,e,f=this.$$aspect,g=f.isAspectOf(c),h=this,i=f.behavior,j=b(f.config);return g||"base"===f.name||this.$enqueue(),d=this.$aspect(b.$name||c),g||(j=b(d.config),i=d.behavior),e=j.apply(null,arguments),a.isArray(e)?i.enqueue(e):e&&(h=e),h},e[c]=d,d)},d.prototype.createProxy.cache={},d.prototype.isAspectOf=function(a){return"base"!==a&&b[a]&&-1!==b[a].$aspect.indexOf(this.name)},d}])}(window.angular),function(a){"use strict";a.module("decipher.debaser").factory("$behavior",["$callConfig",function(b){var c=function(b){a.extend(this,b)};return c.prototype.enqueue=function(a){this.queue.push.apply(this.queue,a)},c.prototype.reset=function(){delete this.queue,delete this.config},c.prototype.flush=function(){return this.queue.map(function(a){return a.deserialize()})},Object.defineProperties(c.prototype,{queue:{get:function(){return this._queue||(this._queue=[]),this._queue},set:function(a){this._queue=a||[]}},config:{get:function(){return this._config||(this._config=new b),this._config},set:function(a){this._config=a||new b}}}),c}])}(window.angular),function(a){"use strict";a.module("decipher.debaser").factory("$call",function(){var a=function(a,b){this.$cfg=a,this.$call=b,delete this.calls};return a.prototype.deserialize=function(){var a=this.$call,b=this.$cfg,c=function(){this.callback(this.object[this.func].apply(this.context,this.args))}.bind(a);return c.toString=function(){return b._provider&&b._provider.toString()},c},function(b){return b.calls.map(function(c){return new a(b,c)})}})}(window.angular),function(a){"use strict";a.module("decipher.debaser").factory("$callConfig",function(){var b=function c(b){a.extend(this,b),this._callbacks=[],this._cb_idx=0,this._id=c._id++,this.calls=this.calls||[]};return b._id=0,b.prototype.addCall=function(b){if(!b)throw new Error("$debaser: addCall() expects call options");b.callback=b.callback||this.runner(),b.context=a.isDefined(b.context)?b.context:b.object||null,this.calls.push(b)},b.prototype.next=function(){this._callbacks[this._cb_idx]?this._callbacks[this._cb_idx++].apply(this,arguments):this.done()},b.prototype.done=function(){this._cb_idx=0},b.prototype.chain=function(a){this._callbacks.push(function(){this.next(a.apply(this,arguments))}.bind(this))},b.prototype.runner=function(){return function(){this.next.apply(this,arguments)}.bind(this)},b.prototype.isChained=function(){return!!this._callbacks.length},Object.defineProperties(b.prototype,{provider:{get:function(){return this._provider},set:function(a){var b=this;this._provider=function(c){a.call(b,c)},this._provider.$inject=["$provide"]}}}),b})}(window.angular),function(a){"use strict";a.module("decipher.debaser").factory("$superpowers",["$call","$window",function(b,c){var d=["create","resetBehavior","isPresent"],e=c.sinon,f=c.console,g=function(a){return"stub"===a.displayName||"spy"===a.displayName},h=function(a){return this.name&&this.stub?a.constant(this.name,this.stub):void 0},i=function(c,d){if(!c)return f.warn("$debaser: ignoring empty call to module()");if(!a.isString(c))throw new Error("$debaser: module() expects a string");if(this.module=c,this.module_dependencies=[],d){if(!a.isArray(d))throw new Error("$debaser: module() expects array or undefined as second parameter");q.withDeps.call(this,d)}return this.addCall({object:a,func:"module",args:[this.module,this.module_dependencies]}),this.addCall({object:a.mock,func:"module",args:[this.module]}),b(this)};i.$aspect=["base"];var j=function(){return arguments.length?(Array.prototype.slice.call(arguments).forEach(function(b){if(!a.isString(b))throw new Error("$debaser: withDep() expects one or more strings")}),void this.module_dependencies.push.apply(this.module_dependencies,arguments)):f.warn("$debaser: ignoring empty call to withDep()")};j.$aspect=["module"];var k=function(b){if(!b)return f.warn("$debaser: ignoring empty call to withDeps()");if(!a.isArray(b))throw new Error("$debaser: withDeps() expects an array");j.apply(this,b)};k.$aspect=["module"];var l=function(b){var c=Array.prototype.slice.call(arguments,1);if(!b)return f.warn("$debaser: ignoring empty call to func()");if(!a.isString(b))throw new Error("$debaser: func() expects a name");return m.call(this,b,e&&e.stub?e.stub.apply(e,c):function(){})};l.$aspect=["base"];var m=function(c,d){if(!c)return f.warn("$debaser: ignoring empty call to object()");if(!a.isString(c))throw new Error("$debaser: object() expects a name");if(d&&!a.isFunction(d)&&!a.isObject(d))throw new Error("$debaser: object() second param should be an Object or undefined");return this.stub||(a.isObject(d)||a.isFunction(d)||(d={}),this.stub=e&&e.stub&&!g(d)?e.stub(d):d),this.isChained()?void 0:(this.name=c,this.component="value",this.provider=function(a){a[this.component](this.name,this.stub)},this.addCall({object:a.mock,func:"module",args:[this.provider]}),b(this))};m.$aspect=["base"];var n=function(a){this.name=a,this.chain(h.bind(this)),l.apply(this,arguments)};n.$aspect=["module"];var o=function(a){this.name=a,this.chain(h.bind(this)),m.apply(this,arguments)};o.$aspect=["module"];var p=function(a){var b=function(b){return a.bind(b)};return b.$aspect=a.$aspect,b.$name=a.$name,b},q={module:p(i),withDep:p(j),withDeps:p(k),withFunc:p(n),withObject:p(o),func:p(l),object:p(m),$SINON_EXCLUDE:d};return a.forEach(q,function(a,b){a.$name||(a.$name=b)}),e&&a.forEach(e.stub,function(b,c){if(a.isFunction(b)&&-1===d.indexOf(c)){var e=function(){var a=b.apply(this.stub,arguments);return a&&a.stub&&a.stub.func?(a.end=function(){return this}.bind(this),a):void 0};e.$aspect=["func","withFunc"],e.$name="func",q[c]=e}}),q}])}(window.angular);
//# sourceMappingURL=debaser.min.js.map